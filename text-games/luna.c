/* luna by whitespace
 * Made for the TIGSource cockpit compo.
 */

// zcc +zx -lndos -create-app -clib=ansi -pragma-define:ansicolumns=51 -DGRAPHUCS luna.c 
 
#ifdef GRAPHICS
#include <games.h>

char lem[] = { 24, 19, 0x00 , 0x00 , 0x00 , 0x02 , 0x00 , 0x10 , 0x02 , 0x00 , 0x08 , 0x16 , 0x00 
, 0x54 , 0x0C , 0x7C , 0x20 , 0x1D , 0x82 , 0x50 , 0x72 , 0x01 , 0x80 , 0x04 
, 0xF8 , 0x80 , 0x09 , 0xDC , 0x60 , 0x11 , 0xFC , 0x10 , 0x19 , 0x8C , 0x30 
, 0x14 , 0xF8 , 0x50 , 0x1A , 0x02 , 0xB0 , 0x0C , 0x15 , 0x60 , 0x0A , 0x7E 
, 0xA0 , 0x07 , 0xC3 , 0xC0 , 0x0C , 0x00 , 0x30 , 0x12 , 0x00 , 0x48 , 0x21 
, 0x00 , 0x84  };

char fire[] = { 
24, 14, 0x0C , 0x00 , 0x60 , 0x1A , 0x00 , 0xB0 , 0x0C , 0x00 , 0x60 , 0x04 , 0x00 
, 0x40 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 
, 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 
, 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00  ,
24, 14, 0x0C , 0x00 , 0x60 , 0x12 , 0x00 , 0x90 , 0x0A , 0x00 , 0xA0 , 0x04 , 0x00 
, 0x40 , 0x04 , 0x00 , 0x40 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 
, 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 
, 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00  ,
24, 14, 0x0C , 0x00 , 0x30 , 0x12 , 0x00 , 0x48 , 0x0A , 0x00 , 0x50 , 0x0A , 0x00 
, 0x50 , 0x04 , 0x00 , 0x20 , 0x00 , 0x00 , 0x00 , 0x04 , 0x00 , 0x20 , 0x00 
, 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 
, 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00  ,
24, 14, 0x0C , 0x00 , 0x30 , 0x12 , 0x00 , 0x48 , 0x12 , 0x00 , 0x48 , 0x0A , 0x00 
, 0x50 , 0x0C , 0x00 , 0x30 , 0x04 , 0x00 , 0x20 , 0x04 , 0x00 , 0x20 , 0x00 
, 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 
, 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00  ,
24, 14, 0x0C , 0x00 , 0x30 , 0x12 , 0x00 , 0x48 , 0x12 , 0x00 , 0x48 , 0x12 , 0x00 
, 0x48 , 0x0A , 0x00 , 0x50 , 0x04 , 0x00 , 0x20 , 0x04 , 0x00 , 0x20 , 0x00 
, 0x00 , 0x00 , 0x04 , 0x00 , 0x20 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 
, 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00  ,
24, 14, 0x0C , 0x00 , 0x30 , 0x12 , 0x00 , 0x48 , 0x12 , 0x00 , 0x48 , 0x12 , 0x00 
, 0x48 , 0x0A , 0x00 , 0x50 , 0x0E , 0x00 , 0x70 , 0x04 , 0x00 , 0x20 , 0x04 
, 0x00 , 0x20 , 0x04 , 0x00 , 0x20 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 
, 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00  ,
24, 14, 0x0C , 0x00 , 0x30 , 0x12 , 0x00 , 0x48 , 0x12 , 0x00 , 0x48 , 0x12 , 0x00 
, 0x48 , 0x12 , 0x00 , 0x48 , 0x0A , 0x00 , 0x50 , 0x0A , 0x00 , 0x50 , 0x04 
, 0x00 , 0x20 , 0x04 , 0x00 , 0x20 , 0x00 , 0x00 , 0x00 , 0x04 , 0x00 , 0x20 
, 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00  ,
24, 14, 0x0C , 0x00 , 0x30 , 0x12 , 0x00 , 0x48 , 0x12 , 0x00 , 0x48 , 0x12 , 0x00 
, 0x48 , 0x12 , 0x00 , 0x48 , 0x0A , 0x00 , 0x50 , 0x0A , 0x00 , 0x50 , 0x0C 
, 0x00 , 0x30 , 0x04 , 0x00 , 0x20 , 0x04 , 0x00 , 0x20 , 0x00 , 0x00 , 0x00 
, 0x04 , 0x00 , 0x20 , 0x00 , 0x00 , 0x00 , 0x04 , 0x00 , 0x20  ,
24, 14, 0x0C , 0x00 , 0x30 , 0x12 , 0x00 , 0x48 , 0x12 , 0x00 , 0x48 , 0x12 , 0x00 
, 0x48 , 0x11 , 0x00 , 0x88 , 0x11 , 0x00 , 0x88 , 0x0A , 0x00 , 0x50 , 0x0A 
, 0x00 , 0x50 , 0x0A , 0x00 , 0x50 , 0x04 , 0x00 , 0x20 , 0x0C , 0x00 , 0x60 
, 0x04 , 0x00 , 0x20 , 0x08 , 0x00 , 0x40 , 0x04 , 0x00 , 0x20 
};


#endif
 
//#include <curses.h>
//#include <conio.h>
#include <stdio.h>
#include <string.h>
//#include <flos.h>


#define mvprintw(x,y,a,b) printf("\033[%u;%uH",x,y);printf(a,b);
//#define mvprintwi(x,y,a,b) printf("\033[%u;%uH\033[7m",x,y);printf(a,b);printf("\033[27m")

//#define mvprintw(x,y,a,b) cursor_x=x; cursor_y=y; printf(a,b);
//#define clear() printf("\033[J")
#define clear() fputc_cons(12)
#define getch() fgetc_cons()

#define row 40
#define col 39

//#define row 24
//#define col 79

        char *tit = "      ";
        char *title = " LUNA ";
        char *author = "by Whitespace";
        char *cockpit ="Tigsource Cockpit Competition 2009";

		char *fail1 = "You are on the moon.";
		char *fail2 = "You landed too fast.";
		char *fail3 = "Now you're dead.";

		char *succ1 = "You succesfully landed on the moon.";
		char *succ2 = "I wonder what you want to do here.";

int main() {
    while (1) {
        //int row,col;
        int y=0;
        int t=-1;
        int h=550;
        int v=45;
        int f=150;
        int e=48;

        //initscr();
        //curs_set(0);
        //raw();
        //noecho();
        clear();
        //start_color();
        //init_pair(1, COLOR_BLACK, COLOR_WHITE);
        //attron(COLOR_PAIR(1));
        //getmaxyx(stdscr,row,col);
        mvprintw(row/2-1,(col-strlen(tit))/2,"%s",tit);
        mvprintw(row/2,(col-strlen(title))/2,"%s",title);
        mvprintw(row/2+1,(col-strlen(tit))/2,"%s",tit);
        //attroff(COLOR_PAIR(1));
        mvprintw(row/2+3,(col-strlen(author))/2,"%s",author);
        mvprintw(row/2+4,(col-strlen(cockpit))/2,"%s\n",cockpit);
        getch();
        clear();
        while (h>0) {
            clear();
            y=e-48;
            t+=1;
            f-=y;
            if (f<0) {
                f=0;
                y=0;
            };
            v+=(5-y);
            h-=v;
            if (h<0) {
                h=0;
            };
            mvprintw(10,25,"Time:%d",t);
            mvprintw(11,25,"Height:%d",h);
            mvprintw(12,25,"Speed:%d",v);
            mvprintw(13,25,"Fuel:%d",f);
            //attron(COLOR_PAIR(1));
            //mvprintwi(15,8," Burn fuel units:(press 0-9) ",0);
			mvprintw(15,6,"^^^^^^^^^^^ Burn fuel units:(press 0-9) ",0);
            //attroff(COLOR_PAIR(1));
			
#ifdef GRAPHICS
			putsprite (spr_or, 30, (550-h)/6,lem);
			if (y>0)
				putsprite (spr_or, 30, (550-h)/6+19,fire+44*(y-1));
#endif

            if (h==0 && v>5) {
                clear();
                mvprintw(row/2-1,(col-strlen(fail1))/2,"%s",fail1);
                mvprintw(row/2,(col-strlen(fail2))/2,"%s",fail2);
                mvprintw(row/2+1,(col-strlen(fail3))/2,"%s",fail3);
                break;
            };
            if (h==0 && v<6) {
                clear();
                mvprintw(row/2-1,(col-strlen(succ1))/2,"%s",succ1);
                mvprintw(row/2,(col-strlen(succ2))/2,"%s",succ2);
                break;
            };
            e = getch();
            while (e<48 || e>57) {
                e = getch();
            }

        }
        getch();
    }
    //endwin();
    return 0;
}
